{"version":3,"sources":["ListElement.tsx"],"names":["getStartIndex","tnode","parsedIndex","attributes","start","Number","NaN","isNaN","createSymbolicMarkerRenderer","component","style","markerTextStyle","counterRenderer","counterIndex","rtlMarkerReversed","prefix","renderPrefix","suffix","renderSuffix","flexDirection","justifyContent","React","createElement","index","pickMarkerTextStyles","extractMarkerTextStyle","Object","assign","lineHeight","fontSize","color","DEFAULT_TEXT_COLOR","styles","nativeTextFlow","getMarkerBoxStyle","markerWidth","paddingValue","markerBoxWidth","Math","max","width","listStyleTypeFallbackRecord","ol","ul","ListElement","TDefaultRenderer","listType","getFallbackListStyleTypeFromNestLevel","enableExperimentalRtl","enableRemoveTopMarginIfNested","enableRemoveBottomMarginIfNested","enableDynamicMarkerBoxWidth","listStyleSpecs","props","markers","nestLevel","olNestLevel","ulNestLevel","TChildrenRenderer","rtl","direction","removeTopMarginStyle","parent","tagName","nodeIndex","zeroMarginTop","removeBottomMarginStyle","children","length","zeroMarginBottom","ownListType","webTextFlow","listStyleType","selectedListType","__DEV__","match","console","warn","spec","counterStyleRenderer","startIndex","itemProps","rtlLineReversed","dynamicMarkerBoxWidth","renderMarker","type","Component","undefined","markerTextWidth","fixedPaddingRule","paddingLeft","markerBoxWidthStyle","renderChild","childElement","key","markerBoxStyle","shrink","dynamicPaddingStyle","position","StyleSheet","create","marginTop","marginBottom","flexShrink"],"mappings":"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","sourcesContent":["/* eslint-disable react-native/no-inline-styles */\nimport { StyleSheet, Text, View } from 'react-native';\nimport React from 'react';\nimport { TBlock, TNode } from '@native-html/transient-render-engine';\nimport {\n  MarkedListItem,\n  useMarkedList,\n  MarkerBoxProps\n} from '@jsamr/react-native-li';\nimport type {\n  DefaultSupportedListStyleType,\n  InternalRendererProps,\n  ListElementConfig,\n  ListStyleSpec,\n  TChildProps,\n  UnitaryListStyleSpec\n} from '../shared-types';\nimport { useTChildrenRenderer } from '../context/TChildrenRendererContext';\nimport { DEFAULT_TEXT_COLOR } from '../constants';\nimport pick from 'ramda/src/pick';\n\nexport interface ListElementProps<T extends 'ol' | 'ul'>\n  extends InternalRendererProps<TBlock>,\n    ListElementConfig {\n  listType: T;\n  listStyleSpecs: Record<string, ListStyleSpec>;\n}\n\nfunction getStartIndex(tnode: TNode) {\n  const parsedIndex = tnode.attributes.start\n    ? Number(tnode.attributes.start)\n    : Number.NaN;\n  return Number.isNaN(parsedIndex) ? 1 : parsedIndex;\n}\n\nfunction createSymbolicMarkerRenderer(\n  component: UnitaryListStyleSpec['Component']\n) {\n  return ({\n    style,\n    markerTextStyle,\n    counterRenderer,\n    counterIndex,\n    rtlMarkerReversed\n  }: MarkerBoxProps) => {\n    const prefix = counterRenderer.renderPrefix();\n    const suffix = counterRenderer.renderSuffix();\n    return (\n      <View\n        style={[\n          style,\n          {\n            flexDirection: rtlMarkerReversed ? 'row-reverse' : 'row',\n            justifyContent: 'flex-end'\n          }\n        ]}>\n        {<Text style={markerTextStyle}>{prefix}</Text>}\n        {React.createElement(component, {\n          ...(markerTextStyle as any),\n          index: counterIndex\n        })}\n        {<Text style={markerTextStyle}>{suffix}</Text>}\n      </View>\n    );\n  };\n}\n\nconst pickMarkerTextStyles = pick([\n  'fontStyle',\n  'fontSize',\n  'fontWeight',\n  'fontFamily',\n  'fontVariant',\n  'color',\n  'lineHeight'\n]);\n\nfunction extractMarkerTextStyle(tnode: TNode) {\n  return Object.assign(\n    {\n      lineHeight: 14 * 1.3,\n      fontSize: 14,\n      color: DEFAULT_TEXT_COLOR\n    },\n    pickMarkerTextStyles(tnode.styles.nativeTextFlow)\n  );\n}\n\nexport function getMarkerBoxStyle(\n  markerWidth: number | false,\n  paddingValue: string | number | undefined\n) {\n  const markerBoxWidth =\n    typeof markerWidth === 'number'\n      ? typeof paddingValue === 'number'\n        ? Math.max(paddingValue, markerWidth)\n        : markerWidth\n      : paddingValue;\n  return { width: markerBoxWidth };\n}\n\nconst listStyleTypeFallbackRecord: Record<\n  'ol' | 'ul',\n  DefaultSupportedListStyleType\n> = {\n  ol: 'decimal',\n  ul: 'disc'\n};\n\nexport default function ListElement({\n  tnode,\n  TDefaultRenderer,\n  listType,\n  style,\n  getFallbackListStyleTypeFromNestLevel,\n  enableExperimentalRtl = false,\n  enableRemoveTopMarginIfNested = true,\n  enableRemoveBottomMarginIfNested = true,\n  enableDynamicMarkerBoxWidth = false,\n  listStyleSpecs,\n  ...props\n}: ListElementProps<'ol' | 'ul'>) {\n  const markers = tnode.markers;\n  const nestLevel =\n    listType === 'ol' ? markers.olNestLevel : markers.ulNestLevel;\n  const TChildrenRenderer = useTChildrenRenderer();\n  const rtl =\n    enableExperimentalRtl &&\n    (style.direction === 'rtl' || markers.direction === 'rtl');\n  const removeTopMarginStyle =\n    enableRemoveTopMarginIfNested &&\n    tnode.parent?.tagName === 'li' &&\n    tnode.nodeIndex === 0\n      ? styles.zeroMarginTop\n      : null;\n  const removeBottomMarginStyle =\n    enableRemoveBottomMarginIfNested &&\n    tnode.parent?.tagName === 'li' &&\n    tnode.nodeIndex === tnode.parent?.children.length - 1\n      ? styles.zeroMarginBottom\n      : null;\n  const ownListType = tnode.styles.webTextFlow.listStyleType as\n    | DefaultSupportedListStyleType\n    | undefined;\n  const selectedListType =\n    getFallbackListStyleTypeFromNestLevel!(nestLevel) ||\n    ownListType ||\n    listStyleTypeFallbackRecord[listType];\n  const listStyleType = ownListType || selectedListType;\n  if (__DEV__ && !(listStyleType in listStyleSpecs)) {\n    if (listStyleType.match(/^(\"|')/)) {\n      console.warn(\n        \"This library doesn't support strings for list-style-type CSS properties.\"\n      );\n    } else {\n      console.warn(\n        `list-style-type \"${listStyleType}\" is not handled by react-native-render-html. ` +\n          'You can easily provide support for this style via \"customListStyleSpecs\" prop.'\n      );\n    }\n  }\n  const spec =\n    listStyleType in listStyleSpecs\n      ? listStyleSpecs[listStyleType]\n      : listStyleSpecs[selectedListType];\n  const counterRenderer = spec.counterStyleRenderer;\n  const startIndex = getStartIndex(tnode);\n  const markerTextStyle = extractMarkerTextStyle(tnode);\n  const itemProps = useMarkedList({\n    counterRenderer,\n    startIndex,\n    markerTextStyle,\n    rtlLineReversed: rtl,\n    rtlMarkerReversed: rtl,\n    length: tnode.children.length,\n    dynamicMarkerBoxWidth: enableDynamicMarkerBoxWidth,\n    renderMarker:\n      spec.type === 'unitary'\n        ? createSymbolicMarkerRenderer(spec.Component)\n        : undefined\n  });\n  const markerWidth = itemProps.markerTextWidth;\n  const fixedPaddingRule = rtl\n    ? ('paddingRight' as const)\n    : ('paddingLeft' as const);\n  // Fallback to padding-left value on RTL mode\n  const paddingValue = style[fixedPaddingRule] ?? style.paddingLeft;\n  const markerBoxWidthStyle = getMarkerBoxStyle(markerWidth, paddingValue);\n  const renderChild = ({ childElement, key, index }: TChildProps) => (\n    <MarkedListItem\n      key={key}\n      index={index}\n      {...itemProps}\n      markerBoxStyle={[itemProps.markerBoxStyle, markerBoxWidthStyle]}\n      markerTextStyle={itemProps.markerTextStyle}\n      style={itemProps.style}>\n      <View style={styles.shrink}>{childElement}</View>\n    </MarkedListItem>\n  );\n\n  const dynamicPaddingStyle = {\n    position: 'relative' as const,\n    [fixedPaddingRule]: 0\n  };\n  return (\n    <TDefaultRenderer\n      tnode={tnode}\n      style={[\n        style,\n        removeTopMarginStyle,\n        removeBottomMarginStyle,\n        dynamicPaddingStyle\n      ]}\n      {...props}>\n      <TChildrenRenderer tchildren={tnode.children} renderChild={renderChild} />\n    </TDefaultRenderer>\n  );\n}\n\nconst styles = StyleSheet.create({\n  zeroMarginTop: { marginTop: 0 },\n  zeroMarginBottom: { marginBottom: 0 },\n  shrink: { flexShrink: 1 }\n});\n"]}